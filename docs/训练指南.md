# Tiny-VAE è®­ç»ƒå®Œæ•´æŒ‡å—

**æœ€åæ›´æ–°**: 2025-10-12

---

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [é…ç½®é—®é¢˜è¯Šæ–­ä¸ä¿®å¤](#é…ç½®é—®é¢˜è¯Šæ–­ä¸ä¿®å¤)
3. [A800æµ‹è¯•åˆ°H100è¿ç§»](#a800æµ‹è¯•åˆ°h100è¿ç§»)
4. [ç›‘æ§ä¸éªŒè¯](#ç›‘æ§ä¸éªŒè¯)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åœ¨8*A800ä¸Šæµ‹è¯•ï¼ˆ2-4å°æ—¶ï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®å¹¶æ¿€æ´»ç¯å¢ƒ
cd /data/matrix-project/seraena/my_taehv_training
conda activate tiny-vae

# 2. å¯åŠ¨A800æµ‹è¯•ï¼ˆ5000æ­¥ï¼‰
bash train_taehv_h100.sh 8 custom training/configs/taehv_config_a800_fixed.py

# 3. ç›‘æ§ï¼ˆå¦å¼€ç»ˆç«¯ï¼‰
tensorboard --logdir logs --port 6006
```

**ç­‰å¾…1000æ­¥åæ£€æŸ¥PSNR**ï¼š
- âœ… PSNR > 25 dB: æµ‹è¯•æˆåŠŸï¼Œå¯è¿ç§»H100
- âš ï¸ PSNR < 25 dB: éœ€è¦æ£€æŸ¥æ—¥å¿—

### åœ¨8*H100ä¸Šç”Ÿäº§è®­ç»ƒï¼ˆ1-2å¤©ï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®å¹¶æ¿€æ´»ç¯å¢ƒ
cd /data/matrix-project/seraena/my_taehv_training
conda activate tiny-vae

# 2. å¯åŠ¨H100ç”Ÿäº§è®­ç»ƒï¼ˆ100000æ­¥ï¼‰
bash train_taehv_h100.sh 8 custom training/configs/taehv_config_h100_fixed.py

# 3. åå°è¿è¡Œï¼ˆæ¨èï¼‰
nohup bash train_taehv_h100.sh 8 custom training/configs/taehv_config_h100_fixed.py > h100_train.log 2>&1 &

# 4. ç›‘æ§
tensorboard --logdir logs --port 6006
tail -f h100_train.log
```

---

## ğŸ” é…ç½®é—®é¢˜è¯Šæ–­ä¸ä¿®å¤

### PSNRåªæœ‰4.2çš„æ ¹æœ¬åŸå› 

**é—®é¢˜é…ç½®**ï¼ˆåŸå§‹ `taehv_config_h100.py`ï¼‰ï¼š
```python
args.encoder_loss_weight = 1.0          # âŒ å¤ªé«˜
args.decoder_loss_weight = 1.0          # âŒ å¤ªé«˜
args.reconstruction_loss_weight = 0.1   # âŒ å¤ªä½ï¼
args.seraena_loss_weight = 0.3
```

**ä¿®å¤åé…ç½®**ï¼ˆ`taehv_config_h100_fixed.py`ï¼‰ï¼š
```python
args.reconstruction_loss_weight = 10.0  # âœ… æé«˜100å€
args.encoder_loss_weight = 0.1         # âœ… é™ä½
args.decoder_loss_weight = 0.1         # âœ… é™ä½
args.perceptual_loss_weight = 0.1      # âœ… æé«˜
args.seraena_loss_weight = 0.1         # âœ… é™ä½
```

### å…³é”®ä¿®å¤ç‚¹

| å‚æ•° | åŸé…ç½® | ä¿®å¤å | å½±å“ |
|------|--------|--------|------|
| **reconstruction_loss_weight** | 0.1 | **10.0** | â­ æœ€å…³é”® |
| **encoder_loss_weight** | 1.0 | **0.1** | é‡è¦ |
| **decoder_loss_weight** | 1.0 | **0.1** | é‡è¦ |
| **learning_rate** | 5e-5 | **1e-4** | æé«˜è®­ç»ƒé€Ÿåº¦ |
| **early_stopping_patience** | 10000 | **5** | å®é™…å¯ç”¨ |
| **metric_for_best_model** | reconstruction_loss | **psnr** | æ­£ç¡®æŒ‡æ ‡ |
| **num_validation_samples** | 10 | **20** | æ›´å‡†ç¡® |
| **validation_batch_size** | 4 | **2** | é¿å…OOM |

### é¢„æœŸæ•ˆæœ

| æ­¥æ•° | ä¿®å¤å‰PSNR | ä¿®å¤åPSNR | æ”¹å–„ |
|-----|-----------|-----------|------|
| 1000æ­¥ | **4.2 dB** | **25-28 dB** | **+20dB** |
| æœ€ç»ˆ | <10 dB | **28-32 dB** | **+20dB** |

---

## ğŸ”„ A800æµ‹è¯•åˆ°H100è¿ç§»

### é…ç½®å¯¹æ¯”

| é…ç½®é¡¹ | A800æµ‹è¯• | H100ç”Ÿäº§ | è¯´æ˜ |
|--------|---------|---------|------|
| **é…ç½®æ–‡ä»¶** | `taehv_config_a800_fixed.py` | `taehv_config_h100_fixed.py` | å·²ä¿®å¤ |
| **æ•°æ®é›†** | ç”Ÿäº§æ•°æ®é›† | ç”Ÿäº§æ•°æ®é›† | âœ… ç›¸åŒ |
| **åˆ†è¾¨ç‡** | 720Ã—480Ã—12 | 720Ã—480Ã—12 | âœ… ç›¸åŒ |
| **batch_size** | 2 | 2 | âœ… ç›¸åŒ |
| **gradient_accumulation** | 8 | 8 | âœ… ç›¸åŒ |
| **learning_rate** | 1e-4 | 1e-4 | âœ… ç›¸åŒ |
| **reconstruction_loss_weight** | 10.0 | 10.0 | âœ… ç›¸åŒ |
| **è®­ç»ƒæ­¥æ•°** | 5000 | 100000 | A800å¿«é€Ÿæµ‹è¯• |
| **è¾“å‡ºç›®å½•** | `output/a800_test_*` | `output/*` | ä¾¿äºåŒºåˆ† |

**æ ¸å¿ƒè®­ç»ƒå‚æ•°å®Œå…¨ç›¸åŒ**ï¼ŒA800æµ‹è¯•é€šè¿‡åå¯æ— ç¼è¿ç§»åˆ°H100ã€‚

### è¿ç§»æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šA800æµ‹è¯•

```bash
# æ£€æŸ¥ç¯å¢ƒ
cd /data/matrix-project/seraena/my_taehv_training
conda activate tiny-vae
nvidia-smi  # ç¡®è®¤8å¼ A800

# å¯åŠ¨æµ‹è¯•
bash train_taehv_h100.sh 8 custom training/configs/taehv_config_a800_fixed.py

# ç›‘æ§
tensorboard --logdir logs --port 6006
```

**éªŒè¯æˆåŠŸæ ‡å‡†**ï¼š
- Step 1000: PSNR > 25 dB
- GPUåˆ©ç”¨ç‡ > 80%
- è®­ç»ƒlossæŒç»­ä¸‹é™
- æœ€ä½³æ¨¡å‹å·²ä¿å­˜

#### ç¬¬äºŒæ­¥ï¼šH100è¿ç§»

```bash
# ç™»å½•H100æœåŠ¡å™¨ï¼ˆå¦‚æœæ˜¯ä¸åŒæœºå™¨ï¼‰
# ssh your_h100_server

cd /data/matrix-project/seraena/my_taehv_training
conda activate tiny-vae
nvidia-smi  # ç¡®è®¤8å¼ H100

# å¯åŠ¨ç”Ÿäº§è®­ç»ƒ
bash train_taehv_h100.sh 8 custom training/configs/taehv_config_h100_fixed.py

# åå°è¿è¡Œ
nohup bash train_taehv_h100.sh 8 custom training/configs/taehv_config_h100_fixed.py > h100_train.log 2>&1 &
```

### ä»A800æ¢å¤åˆ°H100

```bash
# 1. å¤åˆ¶A800çš„checkpoint
scp -r a800_server:/path/to/output/a800_test_*/checkpoint-3000 ./checkpoints/

# 2. åœ¨H100ä¸Šæ¢å¤è®­ç»ƒ
bash train_taehv_h100.sh 8 custom training/configs/taehv_config_h100_fixed.py --resume checkpoints/checkpoint-3000
```

---

## ğŸ“Š ç›‘æ§ä¸éªŒè¯

### å®æ—¶ç›‘æ§

```bash
# ç»ˆç«¯1: TensorBoard
tensorboard --logdir logs --port 6006

# ç»ˆç«¯2: GPUç›‘æ§
watch -n 1 nvidia-smi

# ç»ˆç«¯3: è®­ç»ƒæ—¥å¿—
tail -f logs/taehv_*/train.log
```

### éªŒè¯æŒ‡æ ‡æ£€æŸ¥

```bash
# æŸ¥çœ‹æœ€ä½³æ¨¡å‹ä¿¡æ¯
cat output/*/best_model/model_info.json

# æŸ¥çœ‹éªŒè¯å†å²
cat output/*/validation_history.json

# æŸ¥çœ‹æœ€æ–°è¾“å‡º
ls -lt output/
```

### é¢„æœŸè®­ç»ƒæ›²çº¿

| æ­¥æ•° | PSNR | SSIM | LPIPS | çŠ¶æ€ |
|-----|------|------|-------|------|
| 100 | 18-22 dB | 0.70-0.80 | 0.15-0.25 | å¼€å§‹å­¦ä¹  |
| 1000 | 25-28 dB | 0.85-0.90 | 0.10-0.15 | æ­£å¸¸è®­ç»ƒ |
| 5000 | 27-30 dB | 0.88-0.92 | 0.08-0.12 | è‰¯å¥½ |
| 10000 | 28-31 dB | 0.90-0.94 | 0.06-0.10 | ä¼˜ç§€ |
| 50000+ | 29-32 dB | 0.92-0.95 | 0.05-0.08 | æ”¶æ•› |

### éªŒè¯ç³»ç»Ÿç‰¹æ€§

- **è‡ªåŠ¨éªŒè¯**: æ¯1000æ­¥è‡ªåŠ¨è¿è¡Œ
- **æŒ‡æ ‡è®¡ç®—**: PSNR, SSIM, LPIPS
- **æœ€ä½³æ¨¡å‹ä¿å­˜**: è‡ªåŠ¨ä¿å­˜åˆ° `output/*/best_model/`
- **æ—©åœæœºåˆ¶**: 5æ¬¡éªŒè¯æ— æ”¹å–„è‡ªåŠ¨åœæ­¢
- **éªŒè¯å†å²**: ä¿å­˜åˆ° `validation_history.json`

---

## ğŸ” æ•…éšœæ’æŸ¥

### PSNRä»ç„¶å¾ˆä½ï¼ˆ<15 dBï¼‰

```bash
# 1. ç¡®è®¤ä½¿ç”¨äº†ä¿®å¤åçš„é…ç½®
cat training/configs/taehv_config_a800_fixed.py | grep reconstruction_loss_weight
# åº”è¯¥çœ‹åˆ°: args.reconstruction_loss_weight = 10.0

# 2. æŸ¥çœ‹è®­ç»ƒloss
tensorboard --logdir logs
# æ£€æŸ¥ train/reconstruction_loss æ˜¯å¦ä¸‹é™

# 3. æŸ¥çœ‹æ•°æ®åŠ è½½æ—¥å¿—
grep "Loaded.*training samples" logs/*/train.log
```

### OOM (Out of Memory)

```bash
# ä¿®æ”¹é…ç½®æ–‡ä»¶
args.train_batch_size = 1          # é™ä½batch size
args.gradient_accumulation_steps = 16  # æé«˜accumulation
args.validation_batch_size = 1     # é™ä½éªŒè¯batch size
```

### H100å’ŒA800ç»“æœå·®å¼‚å¤§

**æ­£å¸¸å·®å¼‚**ï¼š
- H100å¯èƒ½ç¨å¿«ï¼ˆ5-10%ï¼‰
- PSNRåº”è¯¥éå¸¸æ¥è¿‘ï¼ˆÂ±0.5 dBï¼‰

**å¦‚æœå·®å¼‚>2 dB**ï¼š
- æ£€æŸ¥éšæœºç§å­æ˜¯å¦ç›¸åŒ
- æ£€æŸ¥æ•°æ®é›†æ˜¯å¦ç›¸åŒ
- æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦ç›¸åŒ

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### é…ç½®æ–‡ä»¶
- âœ… `training/configs/taehv_config_a800_fixed.py` - A800æµ‹è¯•é…ç½®ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… `training/configs/taehv_config_h100_fixed.py` - H100ç”Ÿäº§é…ç½®ï¼ˆå·²ä¿®å¤ï¼‰
- âš ï¸ `training/configs/taehv_config_a800.py` - æ—§é…ç½®ï¼ˆä¸æ¨èï¼‰
- âš ï¸ `training/configs/taehv_config_h100.py` - æ—§é…ç½®ï¼ˆä¸æ¨èï¼‰

### å¯åŠ¨è„šæœ¬
- `train_taehv_h100.sh` - ç»Ÿä¸€å¯åŠ¨è„šæœ¬ï¼ˆæ”¯æŒA800/H100åˆ‡æ¢ï¼‰
- `train_taehv.sh` - é€šç”¨è®­ç»ƒè„šæœ¬

### DeepSpeedé…ç½®
- `accelerate_configs/deepspeed_8gpu.yaml` - 8å¡DeepSpeedé…ç½®

---

## âœ… æ£€æŸ¥æ¸…å•

### A800æµ‹è¯•å‰
- [ ] condaç¯å¢ƒæ¿€æ´»
- [ ] æ£€æŸ¥GPU: 8å¼ A800
- [ ] æ•°æ®é›†è·¯å¾„å­˜åœ¨
- [ ] ä½¿ç”¨ä¿®å¤åçš„é…ç½®: `taehv_config_a800_fixed.py`
- [ ] lossæƒé‡å·²ä¿®å¤: `reconstruction_loss_weight = 10.0`

### A800æµ‹è¯•å
- [ ] Step 1000 PSNR > 25 dB
- [ ] æœ€ä½³æ¨¡å‹å·²ä¿å­˜
- [ ] éªŒè¯æ›²çº¿å¹³æ»‘
- [ ] æ— OOMæˆ–å…¶ä»–é”™è¯¯

### H100è¿ç§»
- [ ] A800æµ‹è¯•é€šè¿‡
- [ ] H100ç¯å¢ƒå‡†å¤‡å¥½
- [ ] ä½¿ç”¨ä¿®å¤åçš„é…ç½®: `taehv_config_h100_fixed.py`
- [ ] å¯åŠ¨H100è®­ç»ƒ
- [ ] ç›‘æ§éªŒè¯æŒ‡æ ‡

---

## ğŸ¯ é‡è¦æé†’

### âœ… ä½¿ç”¨è¿™äº›é…ç½®ï¼ˆå·²ä¿®å¤ï¼‰
- `training/configs/taehv_config_a800_fixed.py`
- `training/configs/taehv_config_h100_fixed.py`

### âŒ ä¸è¦ä½¿ç”¨è¿™äº›é…ç½®ï¼ˆæœªä¿®å¤ï¼‰
- `training/configs/taehv_config_a800.py`
- `training/configs/taehv_config_h100.py`

### ğŸ”‘ æ ¸å¿ƒä¿®å¤
1. **reconstruction_loss_weight = 10.0** ï¼ˆæœ€å…³é”®ï¼ï¼‰
2. **early_stopping_patience = 5**
3. **metric_for_best_model = "psnr"**
4. **learning_rate = 1e-4**

---

**é¢„æœŸæ—¶é—´**ï¼š
- A800æµ‹è¯•ï¼ˆ5000æ­¥ï¼‰: 2-4å°æ—¶
- H100è®­ç»ƒï¼ˆ100000æ­¥ï¼‰: 1-2å¤©

**æˆåŠŸæ ‡å¿—**ï¼š
- A800æµ‹è¯•PSNR > 25 dB
- H100è®­ç»ƒPSNR > 28 dB
- æœ€ä½³æ¨¡å‹è‡ªåŠ¨ä¿å­˜

